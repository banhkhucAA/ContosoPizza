@page
@model ContosoPizza.Pages.Cart.IndexModel
@{
    ViewData["Title"] = "Cart";
}
@{
    double Bill = 0;
    int TotalQuantity = 0;
}

<h1>Cart</h1>

<div class="row">
    @if (Model.OrderDetails_Show != null)
    {
        <table class="table">
            <thead>
                @if (Model.OrderDetails_Show.Count > 0)
                {
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.OrderDetails_Show[0].ProductName)</th>
                        <th>@Html.DisplayNameFor(model => model.OrderDetails_Show[0].Quantity)</th>
                        <th>@Html.DisplayNameFor(model => model.OrderDetails_Show[0].TotalPrice)</th>
                        <th>@Html.DisplayNameFor(model => model.OrderDetails_Show[0].Image)</th>
                        <th></th>
                    </tr>
                }
            </thead>
            <form method="post">
            <tbody>
                    @for (int i = 0; i < Model.OrderDetails_Show.Count; i++)
                    {
                        var item = Model.OrderDetails_Show[i];
                    <tr>
                        <td>
                                @Html.DisplayFor(modelItem => item.ProductName)
                        </td>
                        <td>
                            <input type="number" name="cartItems[@i].Quantity" value="@item.Quantity" min="1" max="100" />
                            <input type="hidden" name="cartItems[@i].ProductId" value="@item.ProductId" />
                        </td>
                        <td>
                                @Html.DisplayFor(modelItem => item.TotalPrice)
                        </td>
                        <td>
                            <img src="@item.Image" alt="Image" style="max-width: 200px; max-height: 200px;" />
                        </td>
                        <td>
                            <input type="submit" name="Delete" value="Delete" class="btn btn-primary" asp-route-id="@item.ProductId" />
                        </td>
                    </tr>
                        {
                            TotalQuantity += item.Quantity;
                            Bill += item.TotalPrice;
                        }
                    }
                <tr>
                    <td colspan="5" class="text-center">
                            @if (Model.OrderDetails_Show.Count > 0)
                            {
                                <div>
                                <input type="submit" class="btn btn-primary" name="UpdateQuantity" value="Update" />
                                    <a href="/Orders/Create" class="btn btn-primary">Create your order</a>
                                </div>
                            }
                            else
                            {
                                <p>There are no Products in your Cart.</p>
                                <a href="/Products">Go to Products</a>
                            }
                    </td>
                </tr>
            </tbody>
            </form>
        </table>
        @if (Model.OrderDetails_Show.Count > 0)
        {
            <div>Total Quantity: @TotalQuantity</div>
            <div>Current Bill: @Bill $</div>
        }
    }
</div>

